name: Deploy iOS

on:
  workflow_dispatch:
    inputs:
      profile:
        description: 'Build profile'
        required: true
        default: 'production'
        type: choice
        options:
          - production
          - preview

permissions:
  contents: read

jobs:
  quality-checks:
    name: Quality Checks
    uses: ./.github/workflows/reusable-quality-checks.yml
    if: github.ref == 'refs/heads/main'

  build-ios:
    name: Build iOS App
    needs:
      - quality-checks
    uses: ./.github/workflows/reusable-eas-build.yml
    if: |
      github.ref == 'refs/heads/main' &&
      needs.quality-checks.result == 'success'
    with:
      platform: 'ios'
      profile: ${{ github.event.inputs.profile || 'production' }}
    secrets:
      EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

  # Note: Submit to App Store Connect is done manually via:
  # npx eas-cli submit --platform ios --profile production
  #
  # Note: Lokale Builds sind weiterhin m√∂glich:
  # npx eas-cli build --platform ios --profile production
