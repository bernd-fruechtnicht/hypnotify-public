name: Deploy Web

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  quality-checks:
    name: Quality Checks
    uses: ./.github/workflows/reusable-quality-checks.yml
    if: github.ref == 'refs/heads/main'

  deploy-web:
    name: Deploy to Vercel
    runs-on: ubuntu-latest
    needs:
      - quality-checks
    if: |
      github.ref == 'refs/heads/main' &&
      needs.quality-checks.result == 'success'
    environment:
      name: Production – hypnotify

    steps:
      - name: Trigger Vercel Deploy Hook
        run: |
          if [ -z "${{ secrets.VERCEL_DEPLOY_HOOK }}" ]; then
            echo "⚠️  VERCEL_DEPLOY_HOOK secret is not set. Please create a Deploy Hook in Vercel and add it as a GitHub secret."
            exit 1
          fi
          curl -X POST "${{ secrets.VERCEL_DEPLOY_HOOK }}"

  # Note: Vercel Git Integration ist deaktiviert (vercel.json)
  # Deployment erfolgt nur via workflow_dispatch (manuell, nur von main, nach Quality Checks)
  # Lokale Deployments sind weiterhin möglich: vercel deploy --prod
